<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üå¨Ô∏è AIR Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>
  <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen flex flex-col">
  <header class="p-4 border-b bg-white shadow-sm flex items-center justify-between">
    <h1 class="text-2xl font-bold text-blue-600">üå¨Ô∏è AIR Monitor</h1>
    <span id="ai-status" class="text-sm text-gray-500">Connecting...</span>
  </header>

  <main class="flex flex-1 overflow-hidden">
    <!-- LEFT: STATUS + LOGS -->
    <aside class="w-1/4 p-4 border-r overflow-y-auto bg-white">
      <h2 class="text-lg font-semibold mb-3">System Status</h2>
      <div id="status" class="space-y-1 text-sm text-gray-700">Loading...</div>
      <h2 class="text-lg font-semibold mt-6 mb-3">Recent Logs</h2>
      <ul id="logs" class="space-y-2 text-xs text-gray-600"></ul>
    </aside>

    <!-- CENTER: LIVE CHAT -->
    <section class="flex-1 p-4 flex flex-col bg-gray-100">
      <h2 class="text-lg font-semibold mb-2 text-gray-800">AI Chat</h2>
      <div id="chat-box" class="flex-1 overflow-y-auto bg-white rounded-lg shadow p-3 space-y-3 border">
        <div class="text-center text-gray-400 text-sm">Start chatting with AIR...</div>
      </div>
      <form id="chat-form" class="mt-3 flex">
        <input id="chat-input" type="text" placeholder="Type a message..." class="flex-1 border rounded-l-lg px-3 py-2 focus:outline-none" />
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-r-lg">Send</button>
      </form>
    </section>

    <!-- RIGHT: CHARTS -->
    <aside class="w-1/4 p-4 border-l overflow-y-auto bg-white">
      <h2 class="text-lg font-semibold mb-3">System Metrics</h2>
      <div id="charts"></div>
    </aside>
  </main>

  <script type="module">
    import { motion } from "https://cdn.skypack.dev/framer-motion";
    const { Recharts } = window;
    const { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer } = Recharts;

    const backend = "https://a-i-r-backend.onrender.com";

    async function fetchStatus() {
      try {
        const res = await fetch(backend + "/api/status");
        const data = await res.json();
        renderStatus(data);
        updateCharts(data);
        document.getElementById("ai-status").textContent = "Online";
      } catch (e) {
        document.getElementById("ai-status").textContent = "Offline";
      }
    }

    function renderStatus(data) {
      const container = document.getElementById("status");
      container.innerHTML = "";
      for (const [k, v] of Object.entries(data)) {
        const div = document.createElement("div");
        div.textContent = `${k}: ${v}`;
        container.appendChild(div);
      }
    }

    let logs = [];
    function addLog(msg) {
      logs.unshift({ msg, time: new Date().toLocaleTimeString() });
      const list = document.getElementById("logs");
      list.innerHTML = logs.slice(0, 10).map(l => `<li>[${l.time}] ${l.msg}</li>`).join("");
    }

    // AI Chat
    const chatForm = document.getElementById("chat-form");
    const chatInput = document.getElementById("chat-input");
    const chatBox = document.getElementById("chat-box");

    chatForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const text = chatInput.value.trim();
      if (!text) return;
      appendChat("user", text);
      chatInput.value = "";
      const res = await fetch(backend + "/api/ai", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ msg: text })
      });
      const data = await res.json();
      appendChat("ai", data.reply || data);
      addLog("AI responded to query");
    });

    function appendChat(role, text) {
      const div = document.createElement("div");
      div.className = role === "user" ? "text-right" : "text-left";
      div.innerHTML = `
        <div class="inline-block px-3 py-2 rounded-lg ${role === "user" ? "bg-blue-100 text-blue-800" : "bg-gray-200 text-gray-800"} max-w-xs">
          ${text}
        </div>`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Charts
    let chartData = [];
    function updateCharts(data) {
      chartData.push({
        name: new Date().toLocaleTimeString(),
        cpu: data.cpu || Math.random() * 100,
        ram: data.ram || Math.random() * 100,
        mongo: data.mongo || Math.random() * 100
      });
      if (chartData.length > 10) chartData.shift();

      const root = document.getElementById("charts");
      root.innerHTML = `
      <div style="width:100%;height:150px;">
        <svg width="0" height="0"></svg>
        <div id="chart-container"></div>
      </div>`;
      ReactDOM.render(
        React.createElement(Recharts.ResponsiveContainer, { width: "100%", height: 200 },
          React.createElement(Recharts.LineChart, { data: chartData },
            React.createElement(Recharts.XAxis, { dataKey: "name", hide: true }),
            React.createElement(Recharts.YAxis, { domain: [0, 100], hide: true }),
            React.createElement(Recharts.Tooltip, null),
            React.createElement(Recharts.Line, { type: "monotone", dataKey: "cpu", stroke: "#2563eb", strokeWidth: 2 }),
            React.createElement(Recharts.Line, { type: "monotone", dataKey: "ram", stroke: "#16a34a", strokeWidth: 2 }),
            React.createElement(Recharts.Line, { type: "monotone", dataKey: "mongo", stroke: "#f59e0b", strokeWidth: 2 })
          )
        ),
        document.getElementById("chart-container")
      );
    }

    setInterval(fetchStatus, 10000);
    fetchStatus();
  </script>
</body>
</html>


